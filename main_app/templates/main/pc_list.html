{% extends 'base.html' %}
{% load static %}

{% block title %}PC List{% endblock %}

{% block content %}
<div class="container">

  <div class="text-center mt-3 mb-3">
    <h1>PC List</h1>
  </div>

  <div class="row">

    <!-- Left Column -->
    <div class="col-md-3 col-sm-4 mt-3">
      <div class="card h-100">
        <div class="card-header text-center">
          <button id="addPCbutton" class="btn btn-round btn-secondary shadow menu-button mb-2">
            Add PC
          </button>
          <br>
          <a href="{% url 'main_app:pc-list' %}?filter=repair" 
            id="repair-button" class="btn btn-round btn-secondary shadow menu-button mb-2">
            Repair
          </a>
        </div>

        <div class="card-body" id="PCformDiv" hidden>
          <h5 id="form-title">Add a PC</h5>
          <form method="post" id="pc-form" action="{% url 'main_app:add-pc-from-form' %}">
            {% csrf_token %}
            <input type="hidden" name="pc_id" id="pc_id">
            <div class="form-group mt-3">
              {{form.name.errors}}
              {{form.name.label_tag}}
              {{form.name}}
              <span class="text-danger" id="name-error"></span>
            </div>
            <div class="form-group mt-3">
              {{form.ip_address.errors}}
              {{form.ip_address.label_tag}}
              {{form.ip_address}}
              <span class="text-danger" id="ip-address-error"></span>
            </div>
            <div class="form-group mt-3" hidden>
              {{form.status.errors}}
              {{form.status.label_tag}}
              {{form.status}}
            </div>
            <div class="mt-3">
              <p class="mt-1">Status: <span id="status_indicator"></span></p>
              <div id="spinner" style="display: none; text-align:center; margin-top:20px;">
                <div class="loader"></div>
                <p>Connecting...</p>
              </div>
              <button type="button" id="connectButton" class="btn btn-sm btn-secondary">Connect</button>
            </div>
            <div class="form-group mt-3">
              {{form.system_condition.errors}}
              {{form.system_condition.label_tag}}
              {{form.system_condition}}
            </div>
            <div class="mt-3">
              <button type="submit" class="btn btn-sm btn-primary" id="save-button">Save</button>
              <button type="button" id="cancel-button" style="display:none;" class="btn btn-sm btn-secondary">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Right Column -->
    <div class="col-md-9 col-sm-8 mt-3">
      <div class="card">
        <div class="card-body">
          <table class="table table-striped table-hover table-sm">
            <thead class="thead-dark">
              <tr>
                <th>PCs</th>
                <th>IP Address</th>
                <th>Connection</th>
                <th>System Condition</th>
                <th>Booking Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for pc in pc_list %}
              <tr class="edit-row" data-pc-id="{{ pc.pk }}" data-name="{{ pc.name }}" 
                data-ip="{{ pc.ip_address }}" data-status="{{ pc.status }}" data-health="{{ pc.system_condition }}">
                <td>{{ pc.name }}</td>
                <td>{{ pc.ip_address }}</td>
                <td>
                  {% if pc.status == 'connected' %}
                    <span class="badge bg-success">Connected</span>
                  {% else %}
                    <span class="badge bg-danger">Disconnected</span>
                  {% endif %}
                </td>
                <td>
                  {% if pc.system_condition == 'repair' %}
                    <span class="badge bg-warning">Under Repair</span>
                  {% else %}
                    <span class="badge bg-success">Active</span>
                  {% endif %}
                </td>
                <td>
                  {% if pc.booking_status == 'available' %}
                    <span class="badge bg-success">Available</span>
                  {% elif pc.booking_status == 'in_queue' %}
                    <span class="badge bg-warning">In Queue</span>
                  {% elif pc.booking_status == 'in_use' %}
                    <span class="badge bg-danger">In Use</span>
                  {% else %}
                    <span class="badge bg-secondary">Unknown</span>
                  {% endif %}
                </td>
                <td>
                  <button class="btn btn-sm btn-warning toggle-repair-btn" 
                    data-pc-id="{{ pc.pk }}" 
                    data-current-condition="{{ pc.system_condition }}"
                    title="Toggle Repair Status">
                    {% if pc.system_condition == 'repair' %}
                      <i class="fa-solid fa-wrench"></i> Fix
                    {% else %}
                      <i class="fa-solid fa-tools"></i> Repair
                    {% endif %}
                  </button>
                  <a class="btn btn-sm text-danger" href="{% url 'main_app:delete-pc' pk=pc.pk %}" title="Delete PC">
                    <i class="fa-solid fa-trash"></i>
                  </a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
</div>


{% endblock %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="{% static 'js/pc_management.js' %}"></script>
{% endblock %}